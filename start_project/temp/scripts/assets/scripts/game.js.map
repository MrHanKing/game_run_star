{"version":3,"sources":["assets\\scripts\\game.js"],"names":["scoreFX","require","cc","Class","extends","Component","properties","starPrefab","default","type","Prefab","scoreFXPrefab","maxStarDuration","minStarDuration","ground","Node","player","scoreDisplay","Label","scoreAudio","url","AudioClip","btnNode","onLoad","groundY","y","height","starDuration","score","isRunning","scoreFXPool","NodePool","onStartGame","resetScore","setPositionX","getComponent","starMoveAt","p","game","spawnNewStar","string","toString","newStar","instantiate","node","addChild","setPosition","getNewStarPosition","random0To1","timer","randX","randY","jumpHeight","maxX","width","randomMinus1To1","gainScore","pos","self","oneSFX","spawnScoreFX","play","audioEngine","playEffect","update","dt","gameOver","console","log","stopAllActions","director","loadScene","stopMove","enabled","getSceneSize","getContentSize","size","get","init","despawnScoreFX","put"],"mappings":"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","file":"unknown","sourcesContent":["const scoreFX = require('scoreFX');\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        //引用星星预制资源\r\n        starPrefab:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        scoreFXPrefab:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        //星星产生后消失时间的随机范围\r\n        maxStarDuration:0,\r\n        minStarDuration:0,\r\n        //地面节点，用于确定星星生成的高度\r\n        ground:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        //player节点，用于获取主角弹跳的高度，和控制主角行动开关\r\n        player:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        scoreDisplay:{\r\n            default:null,\r\n            type:cc.Label\r\n        },\r\n        scoreAudio:{\r\n            default:null,\r\n            url:cc.AudioClip\r\n        },\r\n        btnNode:{\r\n            default:null,\r\n            type:cc.Node\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        //获取地平面的y轴坐标\r\n        this.groundY = this.ground.y + this.ground.height / 2;\r\n        //初始化星星存在时间\r\n        this.starDuration = 0;\r\n        this.score = 0;\r\n        this.isRunning = false;\r\n\r\n        //对象池\r\n        this.scoreFXPool = new cc.NodePool('scoreFX');\r\n    },\r\n\r\n    onStartGame:function(){\r\n        this.resetScore();\r\n        this.isRunning = true;\r\n        this.btnNode.setPositionX(3000);\r\n        this.player.getComponent(\"player\").starMoveAt(cc.p(0,this.groundY));\r\n        this.player.getComponent(\"player\").game = this;\r\n        //生成一个新的星星\r\n        this.spawnNewStar();\r\n    },\r\n\r\n    resetScore:function(){\r\n        this.score = 0;\r\n        this.scoreDisplay.string = \"Score:\" + this.score.toString();\r\n    },\r\n\r\n    spawnNewStar:function(){\r\n        //使用给定的模板在场景中生成一个新节点\r\n        var newStar = cc.instantiate(this.starPrefab);\r\n        //将新增的节点添加到Canvas节点下面\r\n        this.node.addChild(newStar);\r\n        //为星星设置一个随机位置\r\n        newStar.setPosition(this.getNewStarPosition());\r\n        //设置星星存在时间&重置gameOver计时器\r\n        this.starDuration = this.minStarDuration + cc.random0To1() * (this.maxStarDuration - this.minStarDuration);\r\n        this.timer = 0;\r\n        //将game组件的实例传入星星组件\r\n        newStar.getComponent('star').game = this;\r\n    },\r\n    \r\n    //随机生成星星坐标位置\r\n    getNewStarPosition:function(){\r\n        var randX = 0;\r\n        var randY = this.groundY + cc.random0To1() * this.player.getComponent('player').jumpHeight + 29;\r\n        var maxX = this.node.width/2;\r\n        randX = cc.randomMinus1To1() * maxX;\r\n        return cc.p(randX,randY);\r\n    },\r\n    \r\n    //得分\r\n    gainScore:function(pos){\r\n        var self = this;\r\n        self.score += 1;\r\n        self.scoreDisplay.string = \"Score:\" + self.score.toString();\r\n        //effect and music\r\n        var oneSFX = this.spawnScoreFX();\r\n        this.node.addChild(oneSFX.node);\r\n        oneSFX.node.setPosition(pos);\r\n        oneSFX.play();\r\n        cc.audioEngine.playEffect(this.scoreAudio,false);\r\n    },\r\n    \r\n    update:function(dt){\r\n        if (!this.isRunning) return;\r\n        //游戏失败\r\n        if (this.timer > this.starDuration){\r\n            this.gameOver();\r\n            console.log(\"youxijieshu\");\r\n            return;\r\n        }\r\n        this.timer += dt;\r\n    },\r\n    \r\n    //结束游戏重载场景\r\n    gameOver:function(){\r\n        this.player.stopAllActions();\r\n        cc.director.loadScene('game');\r\n        this.isRunning = false;\r\n        this.btnNode.setPositionX(0);\r\n        this.player.getComponent(\"player\").stopMove();\r\n        this.player.getComponent(\"player\").enabled = false;\r\n    },\r\n\r\n    getSceneSize:function(){\r\n        console.log(\"scene width:\",this.node.getContentSize().width);\r\n        return this.node.getContentSize(); \r\n    },\r\n\r\n    spawnScoreFX:function () {\r\n        var oneSFX; \r\n        if (this.scoreFXPool.size() > 0) {\r\n            oneSFX = this.scoreFXPool.get();\r\n            return oneSFX.getComponent('scoreFX');\r\n        }\r\n        else {\r\n            oneSFX = cc.instantiate(this.scoreFXPrefab);\r\n            oneSFX.getComponent('scoreFX').init(this);\r\n            return oneSFX.getComponent('scoreFX');\r\n        }\r\n    },\r\n\r\n    despawnScoreFX:function (scoreFX) {\r\n        this.scoreFXPool.put(scoreFX);\r\n    }\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}