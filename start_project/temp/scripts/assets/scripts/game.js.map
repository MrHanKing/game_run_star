{"version":3,"sources":["assets\\scripts\\game.js"],"names":["cc","Class","extends","Component","properties","starPrefab","default","type","Prefab","maxStarDuration","minStarDuration","ground","Node","player","scoreDisplay","Label","scoreAudio","url","AudioClip","btnNode","onLoad","groundY","y","height","starDuration","score","isRunning","onStartGame","resetScore","setPositionX","getComponent","starMoveAt","p","game","spawnNewStar","string","toString","newStar","instantiate","node","addChild","setPosition","getNewStarPosition","random0To1","timer","randX","randY","jumpHeight","maxX","width","randomMinus1To1","gainScore","self","audioEngine","playEffect","update","dt","gameOver","console","log","stopAllActions","director","loadScene","stopMove","enabled","getSceneSize","getContentSize"],"mappings":"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","file":"unknown","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        //引用星星预制资源\r\n        starPrefab:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        //星星产生后消失时间的随机范围\r\n        maxStarDuration:0,\r\n        minStarDuration:0,\r\n        //地面节点，用于确定星星生成的高度\r\n        ground:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        //player节点，用于获取主角弹跳的高度，和控制主角行动开关\r\n        player:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        scoreDisplay:{\r\n            default:null,\r\n            type:cc.Label\r\n        },\r\n        scoreAudio:{\r\n            default:null,\r\n            url:cc.AudioClip\r\n        },\r\n        btnNode:{\r\n            default:null,\r\n            type:cc.Node\r\n        }\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        //获取地平面的y轴坐标\r\n        this.groundY = this.ground.y + this.ground.height / 2;\r\n        //初始化星星存在时间\r\n        this.starDuration = 0;\r\n        this.score = 0;\r\n        this.isRunning = false;\r\n    },\r\n\r\n    onStartGame:function(){\r\n        this.resetScore();\r\n        this.isRunning = true;\r\n        this.btnNode.setPositionX(3000);\r\n        this.player.getComponent(\"player\").starMoveAt(cc.p(0,this.groundY));\r\n        this.player.getComponent(\"player\").game = this;\r\n        //生成一个新的星星\r\n        this.spawnNewStar();\r\n    },\r\n\r\n    resetScore:function(){\r\n        this.score = 0;\r\n        this.scoreDisplay.string = \"Score:\" + this.score.toString();\r\n    },\r\n\r\n    spawnNewStar:function(){\r\n        //使用给定的模板在场景中生成一个新节点\r\n        var newStar = cc.instantiate(this.starPrefab);\r\n        //将新增的节点添加到Canvas节点下面\r\n        this.node.addChild(newStar);\r\n        //为星星设置一个随机位置\r\n        newStar.setPosition(this.getNewStarPosition());\r\n        //设置星星存在时间&重置gameOver计时器\r\n        this.starDuration = this.minStarDuration + cc.random0To1() * (this.maxStarDuration - this.minStarDuration);\r\n        this.timer = 0;\r\n        //将game组件的实例传入星星组件\r\n        newStar.getComponent('star').game = this;\r\n    },\r\n    \r\n    //随机生成星星坐标位置\r\n    getNewStarPosition:function(){\r\n        var randX = 0;\r\n        var randY = this.groundY + cc.random0To1() * this.player.getComponent('player').jumpHeight + 29;\r\n        var maxX = this.node.width/2;\r\n        randX = cc.randomMinus1To1() * maxX;\r\n        return cc.p(randX,randY);\r\n    },\r\n    \r\n    //得分\r\n    gainScore:function(){\r\n        var self = this;\r\n        self.score += 1;\r\n        self.scoreDisplay.string = \"Score:\" + self.score.toString();\r\n        cc.audioEngine.playEffect(this.scoreAudio,false);\r\n    },\r\n    \r\n    update:function(dt){\r\n        if (!this.isRunning) return;\r\n        //游戏失败\r\n        if (this.timer > this.starDuration){\r\n            this.gameOver();\r\n            console.log(\"youxijieshu\");\r\n            return;\r\n        }\r\n        this.timer += dt;\r\n    },\r\n    \r\n    //结束游戏重载场景\r\n    gameOver:function(){\r\n        this.player.stopAllActions();\r\n        cc.director.loadScene('game');\r\n        this.isRunning = false;\r\n        this.btnNode.setPositionX(0);\r\n        this.player.getComponent(\"player\").stopMove();\r\n        this.player.getComponent(\"player\").enabled = false;\r\n    },\r\n\r\n    getSceneSize:function(){\r\n        console.log(\"scene width:\",this.node.getContentSize().width);\r\n        return this.node.getContentSize(); \r\n    }\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}